"use strict";function Vic(t,e){return this.fps=40,this.standardWidth=640,this.standardHeight=360,this.items=t,this.$el=e,this.$video=this.$el.find("video"),this.$video_wrap=this.$video.parent(),this.$selected_item_wrap=this.$el.find(".selected_item_wrap"),this.controls={$play:this.$el.find(".controls .play"),$pause:this.$el.find(".controls .pause")},this.video=this.$video[0],this.pauseFlag=!1,this.started=!1,this.templates={modal:_.template($("#vic_modal_contents").html()),selected_item:_.template($("#vic_selected_item").html())},this.$pointer=$(".vic-mouse"),this.init(),this}function initializeVic(){for(var t=0;items.length>t;t++){new Vic(items[t],$("#video-"+t));for(var e=0;items[t].length>e;e++){var i=$("<form>");shopCartConf.id="form-"+items[t][e].itemName,i.attr(shopCartConf),items[t][e].cartProps&&$.each(items[t][e].cartProps,function(t,e){i.append($("<input>").attr({name:t,value:e}))}),i.append($("<input>").attr({type:"submit",name:"買い物カゴに入れる"})),$("body").append(i)}$("body").append($('<iframe name="nodisp" id="naiyo" style="display:none">'))}}Vic.prototype.play=function(){0==this.started?(this.createItemObjects(),this.started=!0,this.pointerPlay_()):this.pauseFlag=!1,this.controls.$play.hide(),this.controls.$pause.fadeIn(),this.video.play()},Vic.prototype.pause=function(){0==this.started||(this.pauseFlag=!0,this.controls.$pause.hide(),this.controls.$play.fadeIn()),this.video.pause()},Vic.prototype.pointerPlay_=function(){function t(){setTimeout(function(){if(i.ended)e.started=!1,$("#timeDisplay").text("");else{if(!e.pauseFlag)for(var o=0;a.length>o;o++){var n=a[o].$dom;n.data("startTime")<i.currentTime&&!n.data("added")?(n.data("added",!0),e.putItem(n)):n.data("endTime")<i.currentTime&&n.data("added")?(n.stop(),n.css("display","none")):e.moveItem(n)}t(),$("#timeDisplay").text(i.currentTime)}},1e3/e.fps)}var e=this,i=this.video,a=this.items;t()},Vic.prototype.createItemObjects=function(){for(var t=this,e=this.items,i=0;e.length>i;i++){var a=e[i].itemName,o=e[i].top*$(".video").attr("height")/this.standardHeight;console.log("original height::::"+$(".video").attr("height")),console.log("original top::::"+e[i].top),console.log("top::::"+o);var n=e[i].left*$(".video").attr("width")/this.standardWidth,s=e[i].width*$(".video").attr("width")/this.standardWidth,d=e[i].height*$(".video").attr("height")/this.standardHeight,r=e[i].startTime,c=e[i].startTime+e[i].duration,l=e[i].url,p=e[i].translateX/(e[i].duration*this.fps),h=e[i].translateY/(e[i].duration*this.fps),m=$("<div>",{id:a,"class":"vic-itemPointer"});if(m.css({top:o,left:n,position:"absolute",width:s,height:d}),m.data("startTime",r),m.data("endTime",c),m.data("url",l),m.data("distanceByFrameX",p),m.data("distanceByFrameY",h),m.data("top",o),m.data("left",n),m.data("width",s),m.data("height",d),"undefined"!=typeof e[i].tag){var f=$("<div>").css(e[i].tag.css);e[i].tag.text&&f.append($("<p>"+e[i].tag.text+"</p>")),m.append(f)}e[i].$dom=m,m.on("click",e[i],function(e){e.data.selected=!0,t.renderSelectedItems()}),m.bind({mouseover:function(){console.log("enter"),t.$pointer.fadeIn()},mouseout:function(){console.log("out"),t.$pointer.fadeOut()}})}},Vic.prototype.putItem=function(t){this.$video_wrap.append(t)},Vic.prototype.movieStop=function(){this.pause()},Vic.prototype.moveItem=function(t){t.data("added")&&(t.data("left",t.data("left")+t.data("distanceByFrameX")),t.data("top",t.data("top")+t.data("distanceByFrameY")),t.css({left:t.data("left")}),t.css({top:t.data("top")}))},Vic.prototype.openModal=function(t){var e=this,i=$(this.templates.modal({item:t})),a=this.$video_wrap;return i.find(".close").on("click",function(){i.remove(),e.play()}),i.find(".add_item").on("click",function(){t.selected=!1,t.cartAdded=!0,e.addCart(t)}),a.append(i),this},Vic.prototype.addCart=function(t){$("#form-"+t.itemName).submit(),console.log(t.itemName),this.renderSelectedItems()},Vic.prototype.renderSelectedItems=function(){var t=_.where(this.items,{selected:!0}),e=_.where(this.items,{cartAdded:!0}),i=this,a=this.$selected_item_wrap.find(".vic-btn_area"),o=this.$selected_item_wrap.find(".selected_item_area");a.empty(),t.length>0||e.length>0?(a.html('<div class="vic-btn vic-btn-default add_to_cart"><a href='+shopCartConf.cartUrl+' target="_blank">購入手続きへ進む</a></div>'),a.find(".add_to_cart").on("click",function(){})):a.find(".btn_area").empty(),o.empty();for(var n=0;t.length>n;n++){var s=$(this.templates.selected_item({item:t[n]}));s.find(".unselect").each(function(){$(this).on("click",t[n],function(t){t.data.selected=!1,i.renderSelectedItems()})}),s.on("click",t[n],function(t){i.movieStop(),i.openModal(t.data)}),s.on("mouseenter",t[n],function(){$(this).find(".item_image_layer").css("background-color","rgba(0,0,0,0.5)").append('<div class="layer_inner"><i class="icon-detail"></i></div>')}),s.on("mouseleave",t[n],function(){$(this).find(".item_image_layer").css("background-color","").empty()}),o.append(s)}for(var n=0;e.length>n;n++){var s=$(this.templates.selected_item({item:e[n]}));s.find(".item_image_layer").each(function(){console.log("000000000000000000"),console.log($(this)),$(this).css("background-color","rgba(0,0,0,0.5)").append('<div class="layer_inner"><i class="icon-cart"></i></div>')}),o.append(s)}},Vic.prototype.init=function(){var t=this;this.controls.$play.hide(),this.controls.$pause.hide(),this.$el.find(".play").each(function(){$(this).on("click",function(){t.play()})}),this.$el.find(".pause").each(function(){$(this).on("click",function(){t.pause()})}),this.$video_wrap.on("mouseenter",function(){t.showControls()}),this.$video_wrap.on("mouseleave",function(){t.hideControls()}),this.video.addEventListener("playing",function(e){t.onPlaying(e)}),this.video.addEventListener("ended",function(e){t.started=!1,t.controls.$play.fadeIn(),t.controls.$pause.hide(),t.onEnded(e)}),$(document).off("mousemove"),this.$pointer.hide(),$(document).on("mousemove",function(e){t.followPointer(e)}),this.createItemObjects()},Vic.prototype.showControls=function(){this.started?this.controls.$pause.fadeIn():this.controls.$play.fadeIn()},Vic.prototype.hideControls=function(){this.started?this.controls.$pause.fadeOut():this.controls.$play.fadeOut()},Vic.prototype.onPlaying=function(){console.log("playing")},Vic.prototype.onEnded=function(){console.log("ended")},Vic.prototype.followPointer=function(t){var e=t.pageX-13,i=t.pageY-18,a=50,o=50;a+=e-a,o+=i-o,this.$pointer.css({left:a,top:o})},window.onload=function(){initializeVic()};var items=[[{itemName:"item1",top:24,left:278,width:195,height:301,startTime:15,url:"",details:{name:"美脚ストレートパンツ",price:"1,900-",description:"膝位置高めで脚長効果抜群。内側ボタン式だからウエストすっきり。素材	レーヨン77%・ナイロン20%・ポリウレタン3%  <br>モデル:身長：168cm/Sサイズ",image:{thumbnail:"http://www.dreamvs.jp/images/article/519935/519935-05.jpg",small:"http://www.dreamvs.jp/images/article/519935/519935-05.jpg",large:"http://www.dreamvs.jp/images/article/519935/519935-05.jpg"},item_id:1},translateX:0,translateY:0,duration:8,tag:{text:"",css:{"font-family":"NotoSansCJKjp-Bold",color:"white",fontWeight:"bold",textShadow:"0 1px 1px rgba(0,0,0,.4)",position:"absolute"}},cartProps:{article_id:"380453",quantity:"1",add_time:"1456121258",layaway_id:"0"}}]],shopCartConf={method:"POST",action:"http://www.dreamvs.jp/pc/index.php?toid=PC_CART&amp;fromid=PC_ARTICLE",style:"display:none;",target:"nodisp",cartUrl:"http://www.dreamvs.jp/pc/index.php?toid=PC_CART&fromid=PC_CART"};